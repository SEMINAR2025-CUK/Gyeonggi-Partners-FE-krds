- í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì›¹ì†Œì¼“ ì—°ê²°ì‹œ, ì„œë²„ì˜ http ì—”ë“œí¬ì¸íŠ¸ë¡œ ìµœì´ˆ ì—°ê²° (ì›¹ì†Œì¼“ í•¸ë“œì…°ì´í¬)
- ì´ë•Œ,  ì•„ë˜ì˜ urlë¡œ ì—°ê²° ì‹œë„

<aside>
ğŸ’¡

/gyeonggi_partners-chat

</aside>

1. í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„
    - í´ë¼ì´ì–¸íŠ¸ëŠ” STOMP í”„ë¡œí† ì½œì„ ì‚¬ìš©í•´ `/app` ì´ ë¶™ì€ ëª©ì ì§€ë¡œ ë©”ì„¸ì§€ ë°œí–‰
    - MessageControllerê°€ ë©”ì„¸ì§€ ìˆ˜ì‹ 
2. ì„œë²„ â†’ ë ˆë””ìŠ¤
    - MessageControllerì—ì„œ ë°›ì€ ë©”ì„¸ì§€ë¥¼ dbì— ì €ì¥
    - ë°›ì€ ë©”ì„¸ì§€ëŠ” RedisPublisherë¥¼ í†µí•´ redisì˜ `chatChannel` ë¡œ ë©”ì„¸ì§€ë¥¼ ë°œí–‰
    - ì´ë•Œ chatChannelì€ ë‹¨ì¼ ì±„ë„ì„
3. ë ˆë””ìŠ¤ â†’ ë‹¤ë¥¸ ì „ì²´ ì„œë²„
    - redisì—ì„œ `chatChannel` ì„ êµ¬ë…ì¤‘ì¸ ëª¨ë“  ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ì— ë©”ì„¸ì§€ ì¬ì „ì†¡
4. ë‹¤ë¥¸ ì „ì²´ ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸
    - ê° ì„œë²„ì˜ redisSubscriberê°€ ë©”ì„¸ì§€ ìˆ˜ì‹ 
    - redisSubscriberê°€ webSocket ëª©ì ì§€ë¡œ ë©”ì„¸ì§€ ë¸Œë¡œë“œìºìŠ¤íŒ…
    - ì´ë–„ ì›¹ì†Œì¼“ì˜ ëª©ì ì§€ëŠ” /topic/room/{roomId}
	

# WebSocket  API

## **ì±„íŒ…ë°© ì…ì¥ ì•Œë¦¼**

---

**ëª©ì ì§€**

`/app/chat.addUser`

ì±„íŒ…ë°© ì…ì¥ì‹œ í˜¸ì¶œë˜ì–´ ì„¸ì…˜ì´ userId ë“±ë¡ ë° redisë¡œ join ë©”ì„¸ì§€ **ë°œí–‰**

**í˜ì´ë¡œë“œ** 

**requset â†’ MessageRequestë¡œ ì•„ë˜ 3ê°œê°€ ëª¨ë‘ ë™ì¼**

```java
{
      "type": "CHAT",
      "content": "ì•ˆë…•í•˜ì„¸ìš”, ì§€ê¸ˆ ë…¼ì˜ ê°€ëŠ¥í• ê¹Œìš”?",
      "roomId": 123,
      "userId": 1001
}
```

**response**

ë°˜í™˜ê°’ ì—†ìŒ

## ì±„íŒ… ë©”ì„¸ì§€ ì „ì†¡

---

**ëª©ì ì§€**

`/app/chat.sendMessage`

ì‘ì„±í•œ ë©”ì„¸ì§€ë¥¼ ì„œë²„ë¡œ ì „ì†¡, ë°œí–‰

**í˜ì´ë¡œë“œ**

```java
{
      "type": "CHAT",
      "content": "ì•ˆë…•í•˜ì„¸ìš”, ì§€ê¸ˆ ë…¼ì˜ ê°€ëŠ¥í• ê¹Œìš”?",
      "roomId": 123,
      "userId": 1001
}
```

**response**

ë°˜í™˜ê°’ ì—†ìŒ

## ì±„íŒ…ë°© ë©”ì„¸ì§€ êµ¬ë…

---

**ëª©ì ì§€**

`/topic/room/{roomId}`

í´ë¼ì´ì–¸íŠ¸ê¸° íŠ¹ì • ì±„íŒ…ë°©ì˜ ë©”ì„¸ì§€ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ìˆ˜ì‹ í•˜ê¸° ìœ„í•´ êµ¬ë…í•´ì•¼ í•˜ëŠ” ì±„ë„

**í˜ì´ë¡œë“œ**

**request**

```java
{
      "type": "CHAT",
      "content": "ì•ˆë…•í•˜ì„¸ìš”, ì§€ê¸ˆ ë…¼ì˜ ê°€ëŠ¥í• ê¹Œìš”?",
      "roomId": 123,
      "userId": 1001
}
```

**response**

ë°˜í™˜ê°’ ì—†ìŒ

# REST API

## ë…¼ì˜ë°© ë©”ì„¸ì§€ ì¡°íšŒ

---

**URL**

`GET / api/messages/rooms/{roomId}`

**í˜ì´ë¡œë“œ**

**request**

- Query Parameter
    - Long cursor (ë§ˆì§€ë§‰ìœ¼ë¡œ ì¡°íšŒëœ ë©”ì„¸ì§€ì˜ id)
    - int size (ê¸°ë³¸ê°’ 30ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆìŒ)
- Path Variable
    - Long roomId

**response**

ë‹¤ìŒ í˜ì´ì§€ê°€ ìˆëŠ” ê²½ìš°

```json
{
      "messages": [
        {
          "id": 102,
          "content": "ì´ì „ ë©”ì‹œì§€ 2",
          "userName": "ë°•ì„œë²„",
          "createdAt": "2025-11-10T17:45:30"
        },
        {
          "id": 101,
          "content": "ì´ì „ ë©”ì‹œì§€ 1",
          "userName": "ê¹€ê°œë°œ",
          "createdAt": "2025-11-10T17:45:25"
        }
      ],
      "nextCursor": 101,
      "hasNext": true 
}
```

ë‹¤ìŒ í˜ì´ì§€ê°€ ì—†ëŠ” ê²½ìš°

```json
{
      "messages": [
        {
          "id": 2,
          "content": "ê°€ì¥ ì˜¤ë˜ëœ ë©”ì‹œì§€",
          "userName": "ê¹€ê°œë°œ",
          "createdAt": "2025-11-10T17:01:10"
        },
        {
          "id": 1,
          "content": "ì±„íŒ…ë°©ì´ ê°œì„¤ë˜ì—ˆìŠµë‹ˆë‹¤.",
          "userName": "ê´€ë¦¬ì",
          "createdAt": "2025-11-10T17:01:05"
        }
      ],
      "nextCursor": null,
      "hasNext": false
}
```